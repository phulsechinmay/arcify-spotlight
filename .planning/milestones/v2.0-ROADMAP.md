# Milestone v2.0: Fuse.js Search

**Status:** SHIPPED 2026-02-07
**Phases:** 9-12
**Total Plans:** 10

## Overview

This milestone replaced the hand-rolled matching and scoring system with Fuse.js-based architecture. Fuse.js integration came first (matching foundation), then scoring was rebuilt on top of Fuse.js match quality signals, then performance bottlenecks were eliminated (parallel fetching, debounce, progressive rendering), and finally regression safety was verified end-to-end.

## Phases

### Phase 9: Fuse.js Matching Engine

**Goal:** All data sources use Fuse.js for fuzzy matching with configurable thresholds and field weights
**Depends on:** None (foundation for v2.0)
**Plans:** 4 plans

Plans:
- [x] 09-01: Install Fuse.js, create FuseSearchService, migrate tabs + pinned tabs
- [x] 09-02: Migrate bookmarks (cache + Fuse.js) and history
- [x] 09-03: Migrate popular-sites + top-sites, integrate matchScore, remove fuzzyMatch
- [x] 09-04: Update all unit tests for Fuse.js behavior

**Requirements:** MATCH-01, MATCH-02, MATCH-03, MATCH-04, MATCH-05

**Success Criteria:**
1. Typing a query returns fuzzy-matched results from tabs, bookmarks, and history using Fuse.js (not the old fuzzyMatch function)
2. A title match ranks higher than a URL-only match for the same query
3. Short queries (2-3 characters) do not produce obviously wrong matches
4. Each search result carries a numeric match quality score between 0 and 1
5. Bookmarks use Fuse.js fuzzy matching (not Chrome's substring-only search)

---

### Phase 10: Weighted Scoring System

**Goal:** Results are ranked by a multi-signal formula combining match quality, source type, recency, and frequency
**Depends on:** Phase 9 (requires Fuse.js match quality scores)
**Plans:** 2 plans

Plans:
- [x] 10-01: Weighted multi-signal scoring formula + autocomplete boost
- [x] 10-02: Update and expand scoring tests for new formula

**Requirements:** SCORE-01, SCORE-02, SCORE-03, SCORE-04, SCORE-05

**Success Criteria:**
1. Results are ordered by a combined score that visibly weighs match quality, source type, recency, and visit frequency
2. Open tabs still appear above bookmarks and history for equally strong matches
3. A page visited 5 minutes ago ranks higher than the same page visited 3 weeks ago
4. A page visited 50 times ranks higher than a page visited twice
5. When a query has zero or few local matches, Google autocomplete suggestions appear in results

---

### Phase 11: Performance

**Goal:** Search results appear faster through parallel data fetching, single debounce, and progressive rendering
**Depends on:** None (independent of Phases 9-10)
**Plans:** 3 plans

Plans:
- [x] 11-01: Parallel data fetching (Promise.allSettled) + eliminate double debouncing
- [x] 11-02: Progressive rendering (local results first, autocomplete appends)
- [x] 11-03: Update debounce/cache tests for new architecture

**Requirements:** PERF-01, PERF-02, PERF-03

**Success Criteria:**
1. All data sources fetched in parallel via Promise.allSettled, not sequentially
2. Only one debounce layer exists between keystroke and search execution
3. Local results render immediately, autocomplete suggestions append when they arrive

---

### Phase 12: Regression Validation

**Goal:** All existing functionality works correctly after the v2.0 migration
**Depends on:** Phases 9, 10, 11 (validates everything together)
**Plans:** 1 plan

Plans:
- [x] 12-01: Verify all tests pass (REG-01) + integration regression tests for dedup/enrichment/routing (REG-02)

**Requirements:** REG-01, REG-02

**Success Criteria:**
1. All 300+ existing tests pass with zero failures after the full migration
2. Duplicate results are still deduplicated
3. Arcify enrichment still works
4. Action routing unchanged

---

## Milestone Summary

**Key Decisions:**
- FuseSearchService with centralized config (shared threshold/ignoreLocation across all sources)
- Score inversion inside FuseSearchService (consumers get 1=perfect without manual conversion)
- Weighted additive formula (4 signals: TYPE/MATCH/RECENCY/FREQUENCY with configurable weights)
- Weight redistribution for non-history types (TYPE/MATCH only, renormalized)
- Promise.allSettled for parallel fetching (failed sources return [] without blocking)
- Single debounce at UI layer (background uses immediate path)
- Two-phase progressive rendering (local first, autocomplete appends, stale query guard)
- TestDataProvider pattern (exercise real pipeline through BaseDataProvider subclass)

**Issues Resolved:**
- Double debouncing eliminated (300ms effective delay → 150ms)
- Sequential data fetching replaced with parallel (6 sources concurrent)
- False positive fuzzy matches eliminated (Fuse.js threshold 0.4)
- Bookmark search upgraded from Chrome substring-only to full fuzzy matching
- History scoring now incorporates recency and frequency signals
- Autocomplete suggestions now surface when few local matches exist

**Issues Deferred:**
- Space chip UI (CHIP-01 to CHIP-05) — deferred from v1.5, revisit in v2.1+
- Selection learning (LEARN-01, LEARN-02) — deferred to v2.1+

**Technical Debt:**
- Phase 9 missing VERIFICATION.md (verified indirectly by Phase 12 regression)
- Phase 9 missing SUMMARY.md for plans 09-03 and 09-04 (code committed, documentation gap only)

---

_For current project status, see .planning/ROADMAP.md_
